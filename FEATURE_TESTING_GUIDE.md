# 🧪 功能测试指南

## 测试项目

### ✅ 1. 邮箱重复检查测试

#### 测试步骤：
1. 使用已注册的邮箱（如 `qrzmvp@gmail.com`）尝试注册
2. 应该显示：**"该邮箱已被注册，请使用其他邮箱或直接登录"**
3. 不应该发送注册邮件

#### 预期结果：
- ❌ 不允许重复注册
- ✅ 显示明确的错误提示
- ✅ 不浪费邮件发送配额

### ✅ 2. 完整退出登录测试

#### 测试步骤：
1. 登录到应用
2. 点击右上角用户菜单
3. 点击"退出登录"
4. 检查是否完全退出

#### 预期结果：
- ✅ 自动跳转到登录页面
- ✅ 清除所有本地存储的会话数据
- ✅ 无法通过浏览器后退键返回受保护页面
- ✅ 刷新页面仍然保持退出状态

#### 验证方法：
1. **检查本地存储：**
   - 按 F12 → Application → Local Storage
   - 应该没有 `supabase` 相关的存储项

2. **检查会话存储：**
   - 按 F12 → Application → Session Storage
   - 应该没有 `supabase` 相关的存储项

3. **检查页面访问：**
   - 直接访问 `http://localhost:3001/`
   - 应该自动重定向到登录页面

### ✅ 3. 新用户注册测试

#### 测试步骤：
1. 使用全新的邮箱地址注册
2. 检查注册流程是否正常
3. 验证邮件发送功能

#### 测试邮箱建议：
- `test+1@outlook.com`
- `test+2@gmail.com`  
- `your_name+test@yahoo.com`

## 🔍 调试检查清单

### 控制台日志检查
打开浏览器 F12 → Console，查看：

#### 注册过程日志：
```
=== 开始注册过程 ===
检查邮箱是否已注册: xxx@xxx.com
✅ 邮箱检查通过，可以注册
或
邮箱已注册
```

#### 退出登录日志：
```
=== 开始退出登录 ===
✅ Supabase 会话已清除
清除本地存储: supabase.auth.token
清除会话存储: sb-xxx
✅ 退出登录完成，所有会话数据已清除
```

## 🚨 问题排查

### 问题1: 邮箱重复检查不生效
**可能原因：**
- 数据库权限不足
- profiles 表结构问题

**解决方法：**
```sql
-- 在 Supabase SQL Editor 中执行
SELECT * FROM profiles WHERE email = 'test@example.com';
```

### 问题2: 退出登录不完整
**检查项目：**
1. 本地存储是否已清除
2. 是否自动跳转到登录页
3. 刷新页面是否保持退出状态

### 问题3: 注册后没有收到邮件
**参考之前的邮件调试指南：**
- 检查 Gmail 垃圾邮件文件夹
- 检查 Supabase 邮件配置
- 考虑配置自定义 SMTP

## 📋 完整测试流程

1. **测试邮箱重复检查** ✅
2. **测试新用户注册** ✅  
3. **测试登录功能** ✅
4. **测试退出登录** ✅
5. **验证会话完全清除** ✅

## 🎯 成功标准

- [ ] 重复邮箱无法注册且有明确提示
- [ ] 新邮箱可以正常注册
- [ ] 退出登录后完全清除会话
- [ ] 退出后无法访问受保护页面
- [ ] 所有操作都有相应的用户反馈

完成这些测试后，你的用户认证系统应该就完全正常了！
